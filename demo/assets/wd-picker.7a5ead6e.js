import{d as e,r as l,v as a,q as o,a5 as s,m as t,N as u,h as n,j as i,o as r,c,w as d,a as p,z as m,n as f,u as v,x as y,e as g,F as _,b as k,t as b,p as h,i as w,y as C}from"./index-5b39df8e.js";import{z as V,B as x,j as B,k as S,E as $,H as K,b as I,m as z,F,a as T}from"./page-wraper.5f136bdc.js";import{f as j,_ as q}from"./wd-picker-view.a5c7f358.js";import{u as A}from"./useTranslate.58e1bf0a.js";const H=T(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""},customLabelClass:{default:""},customValueClass:{default:""},customViewClass:{default:""},label:null,placeholder:null,disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingColor:{default:"#4D80F0"},title:null,cancelButtonText:null,confirmButtonText:null,required:{type:Boolean,default:!1},size:null,labelWidth:null,useDefaultSlot:{type:Boolean,default:!1},useLabelSlot:{type:Boolean,default:!1},error:{type:Boolean,default:!1},alignRight:{type:Boolean,default:!1},beforeConfirm:null,closeOnClickModal:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0},ellipsis:{type:Boolean,default:!1},columnsHeight:{default:217},valueKey:{default:"value"},labelKey:{default:"label"},modelValue:{default:""},columns:{default:()=>[]},columnChange:null,displayFormat:null,zIndex:{default:15},prop:null,rules:{default:()=>[]}},emits:["confirm","open","cancel","update:modelValue"],setup(e,{expose:T,emit:H}){const L=e,{translate:M}=A("picker"),O=l(null),W=V(),D=l(!1),P=l(!1),E=l(""),R=l(""),U=l([]),G=l([]),N=l(!1),J=l(!1),Q=a((()=>L.loading||D.value));o((()=>L.displayFormat),(e=>{e&&"function"!==x(e)&&console.error("The type of displayFormat must be Function"),O.value&&O.value.selectedIndex&&0!==O.value.selectedIndex.length&&(L.modelValue?ne(O.value.getSelects()):E.value="")}),{immediate:!0,deep:!0}),o((()=>L.modelValue),(e=>{R.value=e,B(e)?O.value&&O.value.getSelects?s((()=>{ne(O.value.getSelects())})):ne(le(L.modelValue)):E.value=""}),{deep:!0,immediate:!0}),o((()=>L.columns),(e=>{U.value=e,G.value=e,L.modelValue?O.value&&O.value.getSelects?s((()=>{ne(O.value.getSelects())})):ne(le(L.modelValue)):E.value=""}),{deep:!0,immediate:!0}),o((()=>L.columnChange),(e=>{e&&"function"!==x(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:X}=S(F),Y=a((()=>X&&L.prop&&X.errorMessages&&X.errorMessages[L.prop]?X.errorMessages[L.prop]:"")),Z=a((()=>{let e=!1;if(X&&X.props.rules){const l=X.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===L.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return L.required||L.rules.some((e=>e.required))||e})),{proxy:ee}=C();function le(e){const l=j(L.columns,L.valueKey,L.labelKey);if(0===L.columns.length)return;(""===e||null==e||"array"===x(e)&&0===e.length)&&(e=l.map((e=>e[0][L.valueKey])));const a=x(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];0===(e=(e=e instanceof Array?e:[e]).slice(0,l.length)).length&&(e=l.map((()=>0)));let o=[];e.forEach(((e,a)=>{let s=l[a].findIndex((l=>l[L.valueKey].toString()===e.toString()));s=-1===s?0:s,o.push(s)}));const s=o.map(((e,a)=>l[a][e]));return 1===s.length?s[0]:s}function ae(){L.disabled||L.readonly||(H("open"),P.value=!0,R.value=L.modelValue,U.value=G.value)}function oe(){P.value=!1,H("cancel")}function se(){if(Q.value)return;if(N.value)return void(J.value=!0);const{beforeConfirm:e}=L;e&&"function"===x(e)?e(R.value,(e=>{e&&te()}),ee.$.exposed):te()}function te(){if(Q.value||L.disabled)return void(P.value=!1);const e=O.value.getSelects(),l=O.value.getValues(),a=O.value.getColumnsData();P.value=!1,G.value=$(a),H("update:modelValue",l),ne(e),H("confirm",{value:l,selectedItems:e})}function ue({value:e}){R.value=e}function ne(e){if(e instanceof Array&&!e.length||!e)return;const{valueKey:l,labelKey:a}=L;E.value=(L.displayFormat||K)(e,{valueKey:l,labelKey:a})}function ie(){}function re(){N.value=!0}function ce(){N.value=!1,J.value&&(J.value=!1,se())}return t((()=>{L.modelValue&&ne(le(L.modelValue)),L.modelValue&&O.value&&O.value.getSelects&&ne(O.value.getSelects())})),u((()=>{U.value=$(L.columns),G.value=$(L.columns)})),T({close:function(){oe()},open:function(){ae()},setLoading:function(e){D.value=e}}),(l,a)=>{const o=w,s=n(i("wd-icon"),I),t=n(i("wd-picker-view"),q),u=n(i("wd-popup"),z);return r(),c(o,{class:f(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${v(W).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`)},{default:d((()=>[p(o,{class:"wd-picker__field",onClick:ae},{default:d((()=>[e.useDefaultSlot?m(l.$slots,"default",{key:0},void 0,!0):(r(),c(o,{key:1,class:"wd-picker__cell"},{default:d((()=>[e.label||e.useLabelSlot?(r(),c(o,{key:0,class:f(`wd-picker__label ${e.customLabelClass}  ${v(Z)?"is-required":""}`),style:y(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:d((()=>[e.label?(r(),g(_,{key:0},[k(b(e.label),1)],64)):m(l.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):h("",!0),p(o,{class:"wd-picker__body"},{default:d((()=>[p(o,{class:"wd-picker__value-wraper"},{default:d((()=>[p(o,{class:f(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${E.value?"":"wd-picker__placeholder"}`)},{default:d((()=>[k(b(E.value?E.value:e.placeholder||v(M)("placeholder")),1)])),_:1},8,["class"]),e.disabled||e.readonly?h("",!0):(r(),c(s,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"}))])),_:1}),v(Y)?(r(),c(o,{key:0,class:"wd-picker__error-message"},{default:d((()=>[k(b(v(Y)),1)])),_:1})):h("",!0)])),_:1})])),_:3}))])),_:3}),p(u,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:oe,"custom-class":"wd-picker__popup"},{default:d((()=>[p(o,{class:"wd-picker__wraper"},{default:d((()=>[p(o,{class:"wd-picker__toolbar",onTouchmove:ie},{default:d((()=>[p(o,{class:"wd-picker__action wd-picker__action--cancel",onClick:oe},{default:d((()=>[k(b(e.cancelButtonText||v(M)("cancel")),1)])),_:1}),e.title?(r(),c(o,{key:0,class:"wd-picker__title"},{default:d((()=>[k(b(e.title),1)])),_:1})):h("",!0),p(o,{class:f("wd-picker__action "+(v(Q)?"is-loading":"")),onClick:se},{default:d((()=>[k(b(e.confirmButtonText||v(M)("done")),1)])),_:1},8,["class"])])),_:1}),p(t,{ref_key:"pickerViewWd",ref:O,"custom-class":e.customViewClass,modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value=e),columns:U.value,loading:v(Q),"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,onChange:ue,onPickstart:re,onPickend:ce,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class"])}}}),[["__scopeId","data-v-4f3ca579"]]);export{H as _};
