import{B as e,D as a,E as l,o as n,G as t,a as o}from"./page-wraper.5f136bdc.js";import{d as u,r as s,q as i,h as r,j as c,o as d,c as m,w as v,a as f,p,x as h,e as g,F as y,f as w,n as b,b as k,t as _,y as x,a5 as C,i as K,a8 as $,a9 as I}from"./index-5b39df8e.js";function V(a,l,n){let t=a instanceof Array?a:[a];const o=new Set(a.map(e));if(1!==o.size&&o.has("object"))throw Error("The columns are correct");a[0]instanceof Array||(t=[t]);return t.map((a=>a.map((a=>{if("object"!==e(a))return{[l]:a,[n]:a};if(!a.hasOwnProperty(l)&&!a.hasOwnProperty(n))throw Error("Can't find valueKey and labelKey in columns");return a.hasOwnProperty(n)||(a[n]=a[l]),a.hasOwnProperty(l)||(a[l]=a[n]),a}))))}const E=o(u({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""},loading:{type:Boolean,default:!1},loadingColor:{default:"#4D80F0"},columnsHeight:{default:217},valueKey:{default:"value"},labelKey:{default:"label"},modelValue:{type:[String,Number,Boolean,Array]},columns:{default:()=>[]},columnChange:null},emits:["change","pickstart","pickend","update:modelValue"],setup(o,{expose:u,emit:E}){const P=o,S=s([]),j=s(35),D=s([]),O=s([]);i((()=>P.modelValue),((e,l)=>{a(l,e)||H(e)}),{deep:!0,immediate:!0}),i((()=>P.columns),(e=>{S.value=V(e,P.valueKey,P.labelKey),H(P.modelValue)}),{deep:!0,immediate:!0}),i((()=>D.value),(e=>{a(e,O.value)||a(N(),P.modelValue)||F(0)}),{deep:!0,immediate:!0}),i((()=>P.columnChange),(a=>{a&&"function"!==e(a)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{proxy:A}=x();function H(a){if(0===P.columns.length)return;(""===a||null==a||"array"===e(a)&&0===a.length)&&(a=S.value.map((e=>e[0][P.valueKey])));const n=e(a),t=["string","number","boolean","array"];-1===t.indexOf(n)&&console.error(`value must be one of ${t.toString()}`),0===S.value.length&&(S.value=V(P.columns,P.valueKey,P.labelKey)),0===(a=(a=a instanceof Array?a:[a]).slice(0,S.value.length)).length&&(a=S.value.map((()=>0)));let o=l(D.value);a.forEach(((e,a)=>{let l=S.value[a].findIndex((a=>a[P.valueKey].toString()===e.toString()));l=-1===l?0:l,o=T(a,l)})),D.value=o.slice(0,a.length)}function T(e,a){const n=S.value[e];if(!n||!n[a])throw Error(`The value to select with Col:${e} Row:${a} is correct`);const t=l(D.value);if(n[a].disabled){const l=n.slice(0,a).reverse().findIndex((e=>!e.disabled)),o=n.slice(a+1).findIndex((e=>!e.disabled));-1!==l?t[e]=a-1-l:-1!==o?t[e]=a+1+o:void 0===t[e]&&(t[e]=0)}else t[e]=a;return D.value=l(t),D.value}function B({detail:{value:e}}){const a=function(e){e=e.slice(0,S.value.length);const a=l(D.value);let n=l(D.value);e.forEach(((e,l)=>{(e=t(e,0,S.value[l].length-1))!==a[l]&&(n=T(l,e))})),D.value=n,O.value=a;const o=function(e,a){if(!e||!a)return;const l=e.findIndex(((e,l)=>e!==a[l]));return l}(n,a);if(-1===o)return;const u=n[o];return 1===n.length?u:o}(e=e.map((e=>Number(e||0))));D.value=l(e),C((()=>{P.columnChange?P.columnChange.length<4?(P.columnChange(A.$.exposed,G(),a),F(a)):P.columnChange(A.$.exposed,G(),a,(()=>{F(a)})):F(a)}))}function F(e){const l=N();a(l,P.modelValue)||(E("update:modelValue",l),setTimeout((()=>{E("change",{picker:A.$.exposed,value:l,index:e})}),0))}function G(){const e=D.value.map(((e,a)=>S.value[a][e]));return 1===e.length?e[0]:e}function N(){const{valueKey:e}=P,a=D.value.map(((a,l)=>S.value[l][a][e]));return 1===a.length?a[0]:a}function q(){E("pickstart")}function z(){E("pickend")}return u({getSelects:G,getValues:N,setColumnData:function(e,a,l=0){D.value=T(e,l),S.value[e]=V(a,P.valueKey,P.labelKey).reduce(((e,a)=>e.concat(a)),[])},getColumnsData:function(){return S.value.slice(0)},getColumnData:function(e){return S.value[e]},getColumnIndex:function(e){return D.value[e]},getLabels:function(){const{labelKey:e}=P;return D.value.map(((a,l)=>S.value[l][a][e]))},selectedIndex:D}),(e,a)=>{const l=r(c("wd-loading"),n),t=K,u=$,s=I;return d(),m(t,{class:b(`wd-picker-view ${o.customClass}`)},{default:v((()=>[o.loading?(d(),m(t,{key:0,class:"wd-picker-view__loading"},{default:v((()=>[f(l,{color:o.loadingColor},null,8,["color"])])),_:1})):p("",!0),f(t,{style:h(`height: ${o.columnsHeight-20}px;`)},{default:v((()=>[f(s,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${j.value}px;`,style:h(`height: ${o.columnsHeight-20}px;`),value:D.value,onChange:B,onPickstart:q,onPickend:z},{default:v((()=>[(d(!0),g(y,null,w(S.value,((e,a)=>(d(),m(u,{key:a,class:"wd-picker-view-column"},{default:v((()=>[(d(!0),g(y,null,w(e,((e,l)=>(d(),m(t,{key:l,class:b(`wd-picker-view-column__item ${e.disabled?"wd-picker-view-column__item--disabled":""}  ${D.value[a]==l?"wd-picker-view-column__item--active":""}`),style:h(`line-height: ${j.value}px;`)},{default:v((()=>[k(_(e[o.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value"])])),_:1},8,["style"])])),_:1},8,["class"])}}}),[["__scopeId","data-v-0f4873c8"]]);export{E as _,V as f};
