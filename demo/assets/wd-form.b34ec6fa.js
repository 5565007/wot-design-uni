import{d as s,U as e,q as a,o,c as t,w as r,z as p,n as l,x as n,i as u}from"./index-5b39df8e.js";import{w as m,j as c,N as i,E as d,F as f,a as g}from"./page-wraper.5f136bdc.js";import{u as h}from"./useChildren.5fd1f1a4.js";const y=g(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{model:null,rules:{default:()=>({})},resetOnChange:{type:Boolean,default:!0},customClass:{default:""},customStyle:{default:""}},setup(s,{expose:g}){const y=s,{children:v,linkChildren:C}=h(f);let b=e({});function w(s){s?b[s]="":Object.keys(b).forEach((s=>{b[s]=""}))}return C({props:y,errorMessages:b}),a((()=>y.model),(()=>{y.resetOnChange&&w()}),{immediate:!0,deep:!0}),g({validate:async function(s){const e=[];let a=!0;const o=[],t=function(){const s=d(y.rules);return v.forEach((e=>{c(e.prop)&&c(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),r=s?{[s]:t[s]}:t;for(const p in r){const s=r[p],t=m(y.model,p);if(s&&s.length>0)for(const r of s){if(r.required&&(!c(t)||""===t)){e.push({prop:p,message:r.message}),a=!1;break}if(r.pattern&&!r.pattern.test(y.model[p])){e.push({prop:p,message:r.message}),a=!1;break}const{validator:s,...l}=r;if(s){const t=s(y.model[p],l);i(t)?o.push(t.then((s=>{"string"==typeof s?(e.push({prop:p,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:p,message:r.message}),a=!1)})).catch((s=>{e.push({prop:p,message:s||r.message}),a=!1}))):t||(e.push({prop:p,message:r.message}),a=!1)}}}return await Promise.all(o),e.forEach((s=>{var e;(e=s).message&&(b[e.prop]=e.message)})),a&&(s?w(s):w()),{valid:a,errors:e}},reset:function(){w()}}),(e,a)=>{const m=u;return o(),t(m,{class:l(`wd-form ${s.customClass}`),style:n(s.customStyle)},{default:r((()=>[p(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-b905c211"]]);export{y as _};
